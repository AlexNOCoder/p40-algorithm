# 垃圾回收器如何避免对象消失
### 说明

- "对象消失"问题，即原来应该是黑色对象被误标为白色。
- 当且仅当一下两个条件同时满足时，会产生"对象消失"的问题：
  - 赋值器插入了一条或多条从黑色对象到白色对象的新引用。
  - 赋值器删除了全部从灰色对象到白色对象的直接或间接引用
    
- 增量更新：要破坏的是第一条件，当黑色对象插入新的指向白色对象的引用关系时，就将这个新插入的引用记录下来，等并发扫描结束之后，再将这些记录过的引用关系中的黑色对象为根，重新扫描一次。
可以理解为，黑色对象一旦新插入了指向白色对象的引用之后，它就变回灰色对象了(以为新加入的白色节点未被扫描过)。



- 原始快照要破坏的第二个条件，当灰色对象要删除指向白色对象的引用关系时，就将这个要删除的引用记录下来，在并发扫描结束之后，再将这些记录过的引用关系中的灰色对象为根，重新扫描一次。
  这也可以简化理解为，无论引用关系删除与否，都会按照刚刚开始扫描那一刻的对象图快照来进行搜索。
  
- 以上无论是对引用关系记录的插入还是删除，虚拟机的记录操作都是通过写屏障实现的。
 在HotSpot虚拟机中，增量更新和原始快照这两种解决方案都有实际应用，譬如，CMS是基于增量更新来做并发标记的，G1、Shenandoah则是用原始快照来实现
