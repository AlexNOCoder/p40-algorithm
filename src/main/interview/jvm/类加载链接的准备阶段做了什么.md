# 类加载链接的准备阶段做了什么
### 说明

准备阶段是正式为类中定义的变量(即静态变量，被static修饰的变量)分配内存并设置类变量初始值的阶段。

- 从概念上讲，这些变量所使用的内存都应当在方法区中进行分配，但必须主要到方法区本身是一个逻辑上的区域，在JDK7以前，HotSpot使用永久代来实现方法区时，实现是完全符合这种逻辑概念的；
- 在JDK8及之后，类变量则会随着class对象一起存放在java堆中，这时候"类变量在方法区"就完全是一种对逻辑概念的表述。

关于准备阶段，还有两个容易产生混淆的概念需要着重强调，首先是这时候进行内存分配的仅包括类变量，而不包括实例变量，实例变量将会在对象实例化时随着对象一起分配在java堆中。其次是这里所说的初始值"通常情况"下是数据类型的零值，假设一个类变量的定义为：
public static int value = 123；
那变量value在准备阶段过后的初始值为0而不是123，因为这时尚未开始执行任何java方法，而把value赋值为123的putstatic指令是程序被编译后，存放于类构造器<clinit>()方法之中，所以把value赋值为123的动作要到类的初始化阶段才会被执行。
上面提到的"通常情况"下初始值是零值，言外之意是相对的会有某些特殊情况：如果类字段的字段属性表中存在ConstantValue属性，那在准备阶段变量值就会被初始化为ConstantValue属性所指定的初始值。