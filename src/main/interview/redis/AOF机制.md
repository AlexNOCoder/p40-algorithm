# AOF机制

### 说明
- AOF：Append Only File
- 以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录，调操作系统命令进行刷盘
  1. 所有的写命令会追加到AOF缓冲中。
  2. AOF缓冲区根据对应的策略向硬盘进行同步操作
  3. 随着AOF文件越来越大，需要定期对AOF文件进行重写，达到压缩的目的
  4. 当Redis重启时，可以加载AOF文件进行数据恢复

### 优点
- 数据安全，Redis中提供了3种同步策略，即每秒同步、每修改同步和不同步。事实上，每秒同步也是一步完成的，其效率也是非常高的，所差的是一旦系统出现宕机现象，那么这一秒钟之内修改的数据将会丢失。而每修改同步，我们可以将其视为同步持久化，即每次发生的数据变化都会被立即记录到磁盘中。
- 通过append模式写文件，即使中途服务器宕机也不会破坏已经存在的内容，可以通过redis-check-aof工具解决数据一致性问题。
- AOF机制的rewrite模式。定期对AOF文件进行重写，以达到压缩的目的。

### 同步策略

- 每秒同步：异步完成，效率非常高，一旦系统出现宕机现象，那么这一秒之内修改的数据将会丢失
- 每修改同步：同步持久化，每次发生的数据变化都会被记录到磁盘中，最多丢一条
- 不同步：不是不同步，而是由操作系统控制，可能丢失较多数据

### 缺点
- AOF文件比RDB文件大，且恢复速度慢
- 数据集大的时候，比rdb启动效率低
- 运行效率没有RDB高

### 总结
- AOF文件比RDB更新频率高，优先使用AOF还原数据。
- AOF比RDB更安全也更大
- RDB性能比AOF好
- 如果两个都配置了优先加载AOF