# RDB机制

### 说明
- RDB：Redis DataBase  将某一个时刻的内存快照(Snapshot),以二进制的方式写入磁盘
- 在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。

### 触发

- 手动触发：
  - save命令，使redis处于阻塞状态，直到RDB持久化完成，才会响应其他客户端发来的命令，所以在生产环境一定要慎重
  - bgsave命令，fork出一个子进程执行持久化，主进程只在fork过程中有短暂的阻塞，子进程创建之后，主进程就可以响应客户端请求了，利用写时拷贝机制，保证快照不会被主进程修改。
- 自动触发：
  - save m n :在m秒内，如果有n个键发生改变，则自动触发持久化，通过bgsave执行，如果设置多个、只要满足其一就会触发，配置文件有默认配置(可以注释掉)
  - flushall:用于清空redis所有的数据库，flushdb清空当前redis所在库数据(默认是0号数据库),会清空RDB文件，同时也会生成dump.rdb、内容为空
  - 主从同步：全量同步时会自动触发bgsave命令，生成rdb发送给从节点


### 优点
- 整个Redis数据库将只包含一个文件dump.rdb，方便持久化
- 容灾性好，方便备份
- 性能最大化，fork子进程来完成写操作，让主进程继续处理命令，所以是IO最大化。使用单独子进程来进行持久化，主进程不会进行任何IO操作，保证了redis的高性能
- 相对于数据集大时，比AOF的启动效率更高

### 缺点
- 数据安全性低。RDB是间隔一段时间进行持久化，如果持久化之间redis发生故障，会发生数据丢失。所以这种方式更适合数据要求不严谨的时候。
- 由于RDB是通过fork子进程来协助完成数据持久化工作的。因此如果当数据集较大时，可能会导致整个服务器停止服务几百毫秒，甚至一秒钟。会占用cpu。
