# 项目中哪些场景用到了限流、降级？怎么配置的？

### 服务降级的预案
- 在进行降级之前要对系统进行梳理，提前将一个不重要或者不紧急的服务或者任务进行服务的延迟调用或暂停使用。
- 看看哪些服务是不需要誓死保护的，哪些是可以丢卒保帅的；具体可以参考日志级别设置预案：

- 一般：有些服务偶尔因为网络抖动或者服务正在上线而超时，可以自动降级
- 警告：有些服务在一段时间内成功率有波动(如在95~100%之间)，可以自动降级或者人工降级，并发送警告
- 错误：可用率低于90%，或者连接池被占满了，或者访问量突然猛增到系统能承受的最大阈值，此时可以根据情况自动降级或者人工降级
- 严重错误：因为特殊原因数据错误了，此时需要紧急人工降级

### 计算
- 测试会提供准确的数据；
- 自己算：二八法则

- 计算关系：
  - QPS = 并发量/平均响应时间
  - 并发量 = QPS * 平均响应时间
  - 根据以上计算关系，我们来预估下单日访问量在1000w需要多大的QPS来支持：
  - 通常情况下，80%的访问量集中在20%的时间，算一下这1000w pv实际需要机器达到多少qps才能满足
  - QPS = (1000w * 0.8)/（24*3600*0.2）
  - QPS = 462.9
- 根据压力测试的反馈，单台机子的QPS是多少，利用以上结果就可以算出需要几台机器或大致推算出需不需要使用缓存配置
    - 方案一：使用集群服务器 不使用缓存服务器
  - 方案二：使用集群服务器 同时使用缓存服务器 （推荐）
    
### 例子

- 每秒可以处理的请求数QPS(TPS):每秒可以处理的请求或者事务的数量
- 并发数：系统同一时刻处理的请求数量(事务数)
- 响应时间：一般取平均响应时间
- QPS(TPS) = 并发数/平均响应时间
- 并发数 = QPS * 平均响应时间

- 再看如果老板要求实现多少并发数，再反推出机器需要多少QPS，看是否集群配置满足